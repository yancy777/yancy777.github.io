$(function () { var orderShopCart = { el: { isIE: (navigator.userAgent.indexOf("MSIE 6.0")) > 0 ? true : false, goods_content: $('#J_goods'), dialog: $('#J_dialog'), hot_sale_con: $('#J_hot_sale'), activi_con: $('#J_activi'), promote_style: { 'PrmOpt001': '减', 'PrmOpt002': '折', 'PrmOpt003': '赠', 'PrmOpt004': '换', 'PrmOpt005': '特', 'PrmOpt006': '搭' }, promote_con: $('#J_promote_con'), hot_sale: $('#J_hot_sale'), goods_con: $('#J_goods'), chk_all: $('#chkall'), delete_con: $('#J_delete_con'), delete_section: $('#J_delete'), goods_list_data: [], input_data: { warecode: "", isselect: 1, kitorder: 0 }, qty_data: { warecode: "", qty: 0, kitorder: 0 }, del_data: { warecode: '', kitorder: '' }, alert_dialog: $('#J_alert_dialog'), alert_content: $('#J_alert_content'), tofixed_name: ['DownPrice', 'OriginalPrice', 'Price', 'Amount'], pop_form: $('#J_goods_del_tpl'), loading_dialog: $('#J_loadding_dialog'), div_login: $('#divlogin'), style_code: [], brands_id: [], style_code: '', prm_code: '', is_mod: $('#hidModOrderCode').val(), is_can_submit: false, goods_length: 0, auto_dialog: $('#dialogmessage'), load_dialog: $('#J_loading_dialog'), is_first: true, edit_shipper: 0, current_shipper: '', is_over_sea: 0, is_login: 0 }, tpl: { goods_del_tpl: $('#J_goods_del_tpl'), promote_tpl: $('#J_promote_tpl').html(), hot_sale_tpl: $('#J_hot_sale_tpl').html(), goods_tpl: $('#J_goods_tpl').html(), shopcart_act_tpl: $('#J_shopcart_act_tpl').html(), edti_act_tpl: $('#J_edti_act_tpl').html(), cell_tpl: $('#J_cell_tpl').html(), delete_tpl: $('#J_delete_tpl').html(), sq_tpl: $('#J_sq_tpl').html() }, message: { ajax_error: '系统繁忙，请稍后再试！' }, init: function () { this.isLogin(); this.initLoadingDialog(); this.initPost(); this.event() }, initPost: function () { this.changePost() }, initLoadingDialog: function () { var _this = this; _this.el.load_dialog.dialog({ autoOpen: false, width: 150, height: 180, title: '消息提示' }); _this.el.auto_dialog.dialog({ autoOpen: false, width: 600, height: 200, title: '消息提示' }) }, event: function () { this.shopListEvent(); this.editPageEvent(); this.chkEvent(); this.popFormEvent(); this.deleteColumnEvent(); this.promoteEvent(); this.removePromote(); this.sqEvent() }, goodsList: function () { var _this = this, html; $.post('/Cart/ShoppingCartItem', function (data) { _this.el.is_can_submit = false; if (!data || data == null) { var data = {}; data.CartInfoList = []; data.IsLogin = _this.el.islogin } if ($('#hdHisPvh').val() && $('#J_recent_view').length > 0) { _this.recentView() } data.ModOrderCode = _this.el.is_mod; data = _this.handleCartItemData(data); _this.el.goods_length = data.CartInfoList.length || 0; if (_this.el.goods_length <= 0) { data['CartInfoList'] = []; data.IsLogin = _this.el.islogin } _this.el.edit_shipper = data['CartInfoList'].length; html = easyTemplate(_this.tpl.goods_tpl, data).toString(); _this.el.goods_con.html(html); _this.chkAll(); if (!_this.el.is_mod) { _this.getPromote() } else { _this.el.load_dialog.dialog('close') } if ($('#J_goods_del_tpl').length > 0) { $('#J_goods_del_tpl').addClass('fn-none') } _this.getStatisticsCode(); _this.hotSale(); if (_this.el.is_first) { _this.activityShow(); if (_this.el.goods_length > 0 && !_this.el.isIE) { if ($('#J_order_line').length > 0) { floatingBar('#J_order_line', '#J_order_float_line', 'fn-none') } $(window).bind('scroll', function (e) { if ($('#J_order_line').length > 0 && !_this.el.isIE) { floatingBar('#J_order_line', '#J_order_float_line', 'fn-none') } }); _this.el.is_first = false } } }, 'json') }, getStatisticsCode: function () { $.post("/cart/statisticscode", function (data) { $("#statisticsCode").html(data) }) }, handleCartItemData: function (data) { var _this = this, info_num = 0, info_data = data.CartInfoList, info_length = info_data.length, cart_length = 0; if (info_length > 0) { var overseatype = 0; for (var i = 0; i < info_data.length; i++) { if (info_data[i].IsCanSubmit == false) continue; overseatype = parseInt(info_data[i].OverSeaType); if (overseatype == 0) continue; break } _this.el.is_over_sea = overseatype } _this.el.brands_id = data.BrandIDs; _this.el.style_code = data.StyleCodes; for (; info_num < info_length; info_num++) { var items_data = info_data[info_num]['CartItems'] || {}, error_items_data = info_data[info_num]['ErrorCartItems'] || {}, gift_items_data = info_data[info_num]['GiftPromtoes'] || {}, free_promote = info_data[info_num]['FreePromtoe'] || {}, shipper_type = info_data[info_num]['SalesType'], items_num = 0, error_num = 0, gift_num = 0, items_length, error_length, gift_length, total_amount = info_data[info_num]['TotalAmount'] * 1, line = "", total_num = 0; items_length = items_data.length; error_length = error_items_data.length; gift_length = gift_items_data.length; info_data[info_num]['CartInfo'] = info_data[info_num]['CartInfo'] || []; if (info_data[info_num]['IsCanSubmit']) { _this.el.is_can_submit = true; if (_this.el.is_mod) { _this.el.current_shipper = info_data[info_num]['FreePromtoe']['ShipperName'] } } for (; items_num < items_length; items_num++) { if (items_data[items_num]['CartItemType'] == 0) { info_data[info_num]['CartInfo'][total_num] = _this.goodsLine(items_data[items_num], 'CartItems'); items_data[items_num].OverSeaType = data.OverSeaType; _this.el.goods_list_data.push(items_data[items_num]); total_num++ } } for (; gift_num < gift_length; gift_num++) { var gift_data = gift_items_data[gift_num]['CartItems']; for (var num = 0, length = gift_data.length; num < length; num++) { gift_data[num]['ProCode'] = gift_items_data[gift_num]['ProCode']; gift_data[num]['GiftType'] = gift_items_data[gift_num]['GiftType']; gift_data[num]['PrmImgUrl'] = gift_items_data[gift_num]['PrmImgUrl']; info_data[info_num]['CartInfo'][total_num] = _this.goodsLine(gift_data[num], 'GiftPromtoes'); total_num++ } _this.el.goods_list_data.push(gift_data[gift_num]) } for (; error_num < error_length; error_num++) { info_data[info_num]['CartInfo'][total_num] = _this.goodsLine(error_items_data[error_num], 'ErrorCartItems'); _this.el.goods_list_data.push(error_items_data[error_num]); total_num++ } if (free_promote) { if (free_promote['IsAbroad'] == 0) { line += '<span class="shangjia">以下商品由 ' + free_promote['ShipperName'] + ' 发货</span>'; free_promote['FullAmt'] = numberToFixed(free_promote['FullAmt']); free_promote['Carriage'] = numberToFixed(free_promote['Carriage']); line += '<span class="yunfei">'; if (info_data[info_num]['IsCantCod'] == 0) { line += '支持货到付款；' } if (shipper_type == 1) { if (free_promote['IsMLUser'] == 0) { if (free_promote['FeeAmount'] > 0) { free_promote['FreeShipping'] = _this.numberMinus(total_amount, _this.numberMinus(info_data[info_num]['DisAmount'], info_data[info_num]['GradeDisAmount'])); if (free_promote['FreeShipping'] < 0) { free_promote['FreeShipping'] = 0 } free_promote['FreeShipping'] = _this.numberMinus(free_promote['FullAmt'], free_promote['FreeShipping']); free_promote['FreeShipping'] = numberToFixed(free_promote['FreeShipping']); line += '配送费' + free_promote['Carriage'] + '元，购满' + free_promote['FullAmt'] + '元免配送费（还差<font class="red">' + free_promote['FreeShipping'] + '元</font>）' } else { line += '免配送费' } } else if (free_promote['IsMLUser'] == 1) { line += '免配送费' } else if (free_promote['IsMLUser'] == 2) { line += ' 配送费' + free_promote['Carriage'] + '元' } } else { if (free_promote['FeeAmount'] > 0) { free_promote['FreeShipping'] = _this.numberMinus(total_amount, _this.numberMinus(info_data[info_num]['DisAmount'], info_data[info_num]['GradeDisAmount'])); if (free_promote['FreeShipping'] < 0) { free_promote['FreeShipping'] = 0 } free_promote['FreeShipping'] = _this.numberMinus(free_promote['FullAmt'], free_promote['FreeShipping']); free_promote['FreeShipping'] = numberToFixed(free_promote['FreeShipping']); line += '配送费' + free_promote['Carriage'] + '元，购满' + free_promote['FullAmt'] + '元免配送费（还差<font class="red">' + free_promote['FreeShipping'] + '元</font>）' } else { line += '免配送费' } } line += '</span>' } else { if (free_promote['ShipperCode'] == '000001') { line += '<span class="shangjia">以下商品由 ' + free_promote['ShipperName'] + ' 发货</span>'; if (free_promote['FeeAmount'] > 0) { if (free_promote['FeeAmount'] < free_promote["Carriage"]) { line += '配送费' + free_promote['FeeAmount'] + '元' } else { free_promote['FreeShipping'] = _this.numberMinus(total_amount, _this.numberMinus(info_data[info_num]['DisAmount'], info_data[info_num]['GradeDisAmount'])); if (free_promote['FreeShipping'] < 0) { free_promote['FreeShipping'] = 0 } free_promote['FreeShipping'] = _this.numberMinus(free_promote['FullAmt'], free_promote['FreeShipping']); free_promote['FreeShipping'] = numberToFixed(free_promote['FreeShipping']); line += '配送费' + free_promote['Carriage'] + '元，购满' + free_promote['FullAmt'] + '元有免或减运费活动（还差<font class="red">' + free_promote['FreeShipping'] + '元</font>）' } } else { line += '免配送费' } } else { line += '<span class="shangjia">以下商品不支持国外送货</span>' } } free_promote['FreeLine'] = line } _this.el.goods_length += total_num } data.TotalAmount = numberToFixed(data.TotalAmount); if (data.AmountInfo.NotGradeDisAmount && data.AmountInfo.NotGradeDisAmount > 0) { data.AmountInfo.NotGradeDisAmount = numberToFixed(data.AmountInfo.NotGradeDisAmount); var total_amout = _this.numberMinus(data.TotalAmount, data.AmountInfo.NotGradeDisAmount); if (total_amout < 0) { data['TotalAmoutLine'] = '0.00' } else { data['TotalAmoutLine'] = '<span class="price-icon">￥ </span>' + data.TotalAmount + ' - <span class="price-icon">￥ </span>' + data.AmountInfo.NotGradeDisAmount + ' = <span class="rmb">￥</span><span class="howmuch">' + total_amout + '</span>' } } else { data['TotalAmoutLine'] = '<span class="rmb">￥ </span><span class="howmuch">' + data.TotalAmount + '</span>' } return data }, goodsLine: function (data, category) { var _this = this, fix_data = _this.el.tofixed_name, fix_length = fix_data.length, fix_num = 0; if (data['Qty'] <= 0) { data['Qty'] = 1; data['Amount'] = data['Price'] } if (data['OriginalPrice'] || data['Price']) { var downprice = _this.numberMinus(data['OriginalPrice'], data['Price']); if (downprice > 0) { data['DownPrice'] = downprice } } for (; fix_num < fix_length; fix_num++) { var d = data[fix_data[fix_num]]; if (d) { data[fix_data[fix_num]] = numberToFixed(d) } } if (category == 'ErrorCartItems' || category == 'GiftPromtoes') { data['IsSelectBox'] = 0; data['IsEdit'] = 0; if (category == 'ErrorCartItems') { data['StyleName'] = '<span class="off-shelf">[已下架]</span>' + data['StyleName'] } } else { data['IsSelectBox'] = 1 } if (this.el.is_mod) { if (data.IsCanBuy == 0) { data['selectFlage'] = 'disabled="disabled"' } else { data['selectFlage'] = data.IsSelect == 1 ? 'checked="checked"' : '' } } else { data['selectFlage'] = data.IsSelect == 1 ? 'checked="checked"' : '' } if (category == 'GiftPromtoes') { var url = data['PrmImgUrl']; if (data['GiftType'] != 2 && data['GiftType'] != 3 && data['GiftType'] != 4) { data['isDelect'] = 1 } else { data['isDelect'] = 0 } if (data['GiftType'] != 3 && data['GiftType'] != 4) { data['GitPtyShow'] = 1 } else { data['GitPtyShow'] = 0 } if (url == null || url == '' || url == 'null') { if (data['GiftType'] == 4) { url = '/tpimg/20130201/38zslq.jpg' } else { url = 'http://images3.qjherb.com/ProductImg/middle/2204124010M01.jpg' } data['PrmImgUrl'] = url } data['AddMinus'] = 0; data['IsEdit'] = 0; data['DelClassName'] = 'J_git_del' } else if (category == 'ErrorCartItems') { data['IsEdit'] = 0; data['DelClassName'] = 'J_shell_del'; data['GitPtyShow'] = 1; data['isDelect'] = 1; data['DownPrice'] = 0.00 } else { data['isDelect'] = 1; data['AddMinus'] = 1; data['IsEdit'] = 1; data['DelClassName'] = 'J_del'; data['Remarks'] = ''; data['DownPrice'] = ''; data['GitPtyShow'] = 1 } if (data.IsKit == 1) { var kit_data = data['KitDetail'], kit_html = ''; for (var num = 0, length = kit_data.length; num < length; num++) { kit_html += '<span class="zhiliao">' + kit_data[num]['WareName'] + '</span>' } data['KitDetailList'] = kit_html } return data }, getPromote: function () { var _this = this, length; if (_this.el.goods_length == 0) { _this.el.promote_con.html(''); return } $.get('/ProductPromote/GetPromote', function (data) { _this.el.load_dialog.dialog('close'); if (!data) { _this.alertDialog(_this.message.ajax_error); return } if (data.promoteCanUse.length == 0 && data.promoteCantUse.length == 0) { _this.el.promote_con.html(''); return } var return_data = _this.handlePromoteData(data); html = easyTemplate(_this.tpl.promote_tpl, return_data).toString(); _this.el.promote_con.html(html); _this.el.promote_con.find('dl').each(function (index, element) { var $element = $(element); if ($element.attr('class') != 'more') { if (index >= 5) { $element.addClass('fn-none') } } }) }, 'json') }, handlePromoteData: function (data) { var can_data = data.promoteCanUse, cant_data = data.promoteCantUse, can_length = can_data.length, cant_length = cant_data.length, can_num = 0, cant_num = 0; for (; can_num < can_length; can_num++) { can_data[can_num]['PrmNameDetail'] = can_data[can_num]['PrmName']; if (can_data[can_num]['PrmName'].length > 30) { can_data[can_num]['PrmName'] = can_data[can_num]['PrmName'].substring(0, 27) + '...' } } for (; cant_num < cant_length; cant_num++) { cant_data[cant_num]['PrmNameDetail'] = cant_data[cant_num]['PrmName']; if (cant_data[cant_num]['PrmName'].length > 30) { cant_data[cant_num]['PrmName'] = cant_data[cant_num]['PrmName'].substring(0, 27) + '...' } } return data }, hotSale: function (page_no) { var _this = this, html, li, item_con, length, item_html = [], l = 0; var page_no = 1; var url = "/Cart/GetCmsData?cmsid=13505,13506"; $.ajax({ type: 'get', url: url, dataType: 'json', success: function (data) { var result_data = data || [], new_data, length = result_data.length, result_num = 0, style_code; if (result_data.length == 0) { return } html = easyTemplate(_this.tpl.hot_sale_tpl, data).toString(); _this.el.hot_sale.html(html); li = _this.el.hot_sale.find('li'); length = li.length; if (length > 0) { item_con = _this.el.hot_sale.find('#J_hot_sale_item'); for (; l < length; l++) { var classname; classname = l != 0 ? '' : 'class="no"'; item_html.push('<span ' + classname + '></span>') } item_con.html(item_html.join('')) } $('#J_hot_sale li').soChange({ thumbObj: '#J_hot_sale_item span', thumbNowClass: 'on', changeTime: 500, slideTime: 300, lazyload: false, delay: false, autoChange: false, botNext: '#J_hot_sale_next' }) } }) }, deleRepeatGoods: function (result_data) { var _this = this, length = result_data.length; for (var i = 0; i < length; i++) { var style_code = result_data[i].styleCode; if (_this.el.style_code.indexOf(style_code) != -1) { result_data.splice(i, 1) } } }, activityShow: function () { var _this = this, data = { alsoBuy: _this.el.style_code, history: $('#hdHisPvh').val(), is_mod: this.el.is_mod }; _this.el.activi_con.html(easyTemplate(_this.tpl.edti_act_tpl, data).toString()); if (data['alsoBuy'] != '') { _this.alsoBuy() } if (data['history'] != null) { _this.recentView() } _this.collect() }, alsoBuy: function (cuscode) { var cid = this.el.is_mod ? $.cookie('DefaultCusCode') : ''; var page_size = this.el.is_mod ? 15 : 7; var url = "http://etl.moonbasa.com/recommend.aspx?pagesize=" + page_size + "&pageno=1&model=1&cid=" + cid + "&method=alsobuy&productinfo=full&pids=" + this.el.style_code; var _this = this; $.ajax({ type: 'post', url: url, dataType: 'jsonp', success: function (data) { data = eval('(' + data + ')'); data = _this.handleBuyData(data); var html = easyTemplate(_this.tpl.cell_tpl, data).toString(); $('#J_same_buy_con').html(html) } }) }, handleBuyData: function (data) { var num = 0, length = data.length; for (; num < length; num++) { data[num]['WebAddr'] = data[num]['webAddr']; data[num]['IsKit'] = data[num]['isKit']; data[num]['StyleCode'] = data[num]['styleCode']; data[num]['StylePicPath'] = data[num]['stylePicPath']; data[num]['PicUrl'] = data[num]['picUrl'].replace(data[num]['stylePicPath'], ''); data[num]['StyleName'] = data[num]['styleName']; data[num]['SalePrice'] = data[num]['salePrice']; data[num]['MarketPrice'] = data[num]['marketPrice'] } return data }, recentView: function () { var history = $('#hdHisPvh').val(), url = '/Etl/GetHisory?pvh=' + history, _this = this; $.get(url, function (data) { var html = easyTemplate(_this.tpl.cell_tpl, data).toString(); $('#J_recent_view_con').html(html) }, 'json') }, collect: function () { var _this = this, url = '/Etl/GetFavList', html; if (_this.el.is_login == 1) { html = '<div style="margin: 50px auto; width:200px;">先收藏商品，添加起来更加方便。</div>'; $('#J_collect_con').html(html); _this.el.act_title = _this.el.activi_con.find('#J_act_title'); _this.activityEvent(); return } $.get(url, function (data) { if (!data) { return } if (data.length > 0) { html = easyTemplate(_this.tpl.cell_tpl, data).toString() } else { html = '<div style="margin: 50px auto; width:200px;">先收藏商品，添加起来更加方便。</div>' } $('#J_collect_con').html(html); _this.el.act_title = _this.el.activi_con.find('#J_act_title'); _this.activityEvent() }, 'json') }, activityEvent: function () { var _this = this; $('.J_act_section').soChange({ thumbObj: '#J_act_title span.J_lanmu', thumbNowClass: 'onnn', changeTime: 500, slideTime: 300, autoChange: false, thumbOverEvent: false }) }, molaEtl: function (options) { options = $.extend({ templateId: '', displayId: '', url: '', pars: '', json: 1 }, options); $.mola.etl({ templateid: options.templateId, displayid: options.displayId, url: options.url, pars: options.pars, jsonp: options.json }) }, shopListEvent: function () { var _this = this; $('#J_alert_btn').click(function () { _this.el.alert_dialog.dialog('close') }); _this.el.goods_content.delegate('.J_del', 'click', function (e) { var $this = $(this), position = $this.offset(); _this.el.del_data.warecode = $(this).attr('data-wareCode'); _this.el.del_data.kitorder = $(this).attr('data-kitOrder'); _this.tpl.goods_del_tpl.css({ 'left': position.left - 93, 'top': position.top - 70 }); _this.el.pop_form.removeClass('fn-none') }); _this.el.goods_content.delegate('.J_shell_del', 'click', function () { _this.el.del_data.warecode = $(this).attr('data-wareCode'); _this.el.del_data.kitorder = $(this).attr('data-kitOrder'); _this.delComfirm('no') }); _this.el.pop_form.delegate('#J_del_confirm', 'click', function () { _this.delComfirm(); _this.el.pop_form.addClass('fn-none') }); _this.el.pop_form.delegate('#J_del_cancel', 'click', function () { _this.el.pop_form.addClass('fn-none') }); _this.el.goods_content.delegate('.J_edit', 'click', function () { var $this = $(this), style_code = $(this).attr('data-styleCode'), ware_code = $(this).attr('data-wareCode'), kit_order = $(this).attr('data-kitOrder'); $.post('/cart/ShoppingCartProduct?stylecode=' + style_code + '&warecode=' + ware_code + '&kitorder=' + kit_order, function (data) { $("#J_dialog").html(data); $('#J_dialog').dialog({ title: '选择颜色尺码', width: 800, modal: true }) }) }); _this.el.goods_content.delegate('.J_num', 'focus blur', function (e) { var $this = $(this), value = onlyNumber($this.val()), e_type = e.type, old_value; if (!value) { $this.val(1); return } if (e_type == 'focusin') { old_value = value } else if (e_type == 'focusout') { _this.el.qty_data.warecode = $this.attr('data-wareCode'); _this.el.qty_data.kitorder = $this.attr('data-kitOrder'); _this.el.qty_data.qty = value; _this.updateCartQty($this) } }); _this.el.goods_content.delegate('.J_minus', 'click', function () { var $this = $(this), $input = $this.next(), val; val = parseInt($input.val()); _this.el.qty_data.warecode = $input.attr('data-wareCode'); _this.el.qty_data.kitorder = $input.attr('data-kitOrder'); _this.el.qty_data.qty = val - 1; if (parseInt(val) > 1) { $input.val(_this.el.qty_data.qty); _this.updateCartQty($input) } else { $this.parents('.nr').find('.J_del').trigger('click') } }); _this.el.goods_content.delegate('.J_add', 'click', function () { var $this = $(this), $input = $this.prev(), val; val = parseInt($this.prev().val()); _this.el.qty_data.warecode = $input.attr('data-wareCode'); _this.el.qty_data.kitorder = $input.attr('data-kitOrder'); _this.el.qty_data.qty = val + 1; $input.val(_this.el.qty_data.qty); _this.updateCartQty($input) }); _this.el.goods_content.delegate('#J_clear_car', 'click', function () { $.post('/Cart/ClearCart', function (data) { if (data.Code == 1) { _this.el.is_mod = ''; _this.changePost() } else { _this.alertDialog(data.Message) } }) }); $('body').delegate('.J_add_car', 'click', function () { var $this = $(this), stylecode = $this.attr('data-styleCode'); MLMarket.ShoppingCartProduct(stylecode) }); _this.el.goods_content.delegate('#J_toSettlement', 'click', function () { if (_this.el.is_mod && _this.el.edit_shipper > 1) { alert('您的订单将由【' + _this.el.current_shipper + '】商家直接安排发货，如加订不同商家的商品，请分开下单订购。') } _this.cartSubmit($(this)) }) }, isLogin: function () { var _this = this; $.ajax({ type: 'post', url: '/cart/islogin', dataType: 'json', success: function (data) { _this.el.islogin = data.Code } }) }, login: function () { var _this = this; $.ajax({ type: 'post', url: '/cart/islogin', dataType: 'json', success: function (data) { _this.el.islogin = data.Code; if (_this.el.islogin != 1) { _this.ShowLoginDialog() } }, error: function (error) { _this.alertDialog(error) } }) }, cartSubmit: function ($this) { var _this = this, el = _this.el; if (el.is_login == 1) { if (el.is_over_sea == 1 || el.is_over_sea == 2) { _this.sqDialog() } else { _this.goCartSubmit() } } else { $.ajax({ type: 'post', url: '/cart/islogin', dataType: 'json', success: function (data) { if (data.Code == "1") { if (el.is_over_sea == 1 || el.is_over_sea == 2) { _this.sqDialog() } else { _this.goCartSubmit() } } else { $("#SpanLogin").html("<iframe src=\"" + LoginDomain + "/iframe/login\" height=\"407px\" width=\"490px\" style=\"border:0;\"></iframe>"); $('#divlogin').dialog({ autoOpen: true, width: 550, height: 470, modal: true }) } }, error: function (error) { _this.alertDialog(error) } }) } }, goCartSubmit: function () { var _this = this, el = _this.el; if (el.is_mod) { window.location.href = "/order/modorderpayment" } else { window.location.href = "/order/orderpayment" } }, sqDialog: function () { var _this = this; if ($('.J_sq_dialog').length == 0) { $(_this.tpl.sq_tpl).dialog({ title: '全球购', autoOpen: true, width: 580, height: 480, modal: true }) } else { $('.J_sq_dialog').dialog('open') } }, closeSqDialog: function () { $('.J_sq_dialog').dialog('close') }, sqEvent: function () { var $body = $('body'), _this = this; $body.delegate('.J_sq_comfire', 'click', function () { var check = $('#J_sq_check')[0].checked; if (!check) { _this.messageDialog('请认真阅读授权须知，如同意请勾选“我同意授权须知”后继续！') } else { _this.closeSqDialog(); _this.goCartSubmit() } }); $body.delegate('.J_sq_cancel', 'click', function () { _this.closeSqDialog() }) }, popFormEvent: function () { var $body = $('body'), _this = this; $body.delegate(".selectcolor", "click", function () { var attColor = $(this).attr("color"); var attTitle = $(this).attr("title"); var attForSize = $(this).attr("forSize"); var attStyleId = $(this).attr("styleId"); $("#txtSize" + attForSize).text(""); $("#liSize" + attForSize).html("<span style='color:red;'>数据加载中.....</span>"); var color = $("#SColor").val(); if (attColor != color) { $("#SColor").val(attColor); $("#txtselcolor" + attForSize).text(attTitle); $(this).addClass("selon").siblings().removeClass("selon"); var data = $("#hdColorSize").val(); data = eval('(' + data + ')'); for (var i = 0; i < data.length; i++) { if (data[i].StyleCode.toLowerCase() == attStyleId.toLowerCase()) { for (var j = 0; j < data[i].ColorArr.length; j++) { if (data[i].ColorArr[j].ColorCode == attColor) { var sizes = data[i].ColorArr[j].SpecArr; var styleId = $("#hdStyleId").val(); var strSizes = ""; for (var i = 0; i < sizes.length; i++) { strSizes += '<a  class="selectsize" id="selectsize' + attForSize + '"  title="' + styleId + '" spec="' + sizes[i].WareCode + '" forSize="' + attForSize + '" href="javascript:void(0)" >' + sizes[i].Spec + '</a>' } $("#liSize" + attForSize).html(strSizes); if (sizes.length > 1) { $("#spanCount" + attForSize).html("") } else { var size = $("#selectsize" + attForSize); $(size).bind("click", selectSizeHandle); $(size).trigger("click") } break } } break } } } }); $body.delegate(".selectsize", 'click', function () { $(this).addClass("selon").siblings().removeClass("selon"); var attForSize = $(this).attr("forSize"); $("#txtSize" + attForSize).text($(this).text()); var spec = $(this).attr("spec"); var aitem = spec.split(","); if (aitem[0] == "") return; var count = aitem[1] * 1; var activeQty = count; if (count > 4 || count < 1) { count = 5 } if (!$("#selectCount" + attForSize).attr("disabled")) { var strRst = "<option value='0'>数量</option>"; for (var i = 1; i <= count; i++) { strRst += "<option value='" + i + "' >" + i + "</option>" } $("#selectCount" + attForSize).html(strRst); $("#selectCount" + attForSize).val("1") } if (activeQty > 0) { if (attForSize == "k") { $("#spanAddNotice").hide(); $("#spanAddCart").show() } else { if ($("#hdIsKit").val() == 1) { $("#spanAddKitNotice").hide(); $("#spanAddKitCart").show() } else { $("#btnAddToKitNotice").hide(); $("#btnAddToKitCart").show() } } if (activeQty < 20) { $("#spanCount" + attForSize).html("仅存<font color=red><b> 5 </b></font>件以下") } else if (activeQty < 10) { $("#spanCount" + attForSize).html("仅存<font color=red><b> 10 </b></font>件以下") } else { $("#spanCount" + attForSize).text("现在有货") } } else { if (aitem[2] * 1 < 17) { if (attForSize == "k") { $("#spanAddNotice").hide(); $("#spanAddCart").show() } else { if ($("#hdIsKit").val() == 1) { $("#spanAddKitNotice").hide(); $("#spanAddKitCart").show() } else { $("#btnAddToKitNotice").hide(); $("#btnAddToKitCart").show() } } if (aitem[2] == "0") { $("#spanCount" + attForSize).html("预计今天到货入库，入库后立即发货") } else { $("#spanCount" + attForSize).html("预计<font color=red style='font-size:13px;'><b> " + aitem[2] + " </b></font>天后到货入库，入库后立即发货") } } else { $("#spanCount" + attForSize).html($("#txtselcolor" + attForSize).text() + " " + $(this).text() + " 暂时缺货预计" + aitem[2] + "天后到货,商品到货时我们通知您。"); $(this).removeClass("selon"); $("#txtSize" + attForSize).text(""); $("#NoticeWareCode").val(aitem[0]); if (attForSize == "k") { $("#spanAddCart").hide(); $("#spanAddNotice").show() } else { if ($("#hdIsKit").val() == 1) { $("#spanAddKitCart").hide(); $("#spanAddKitNotice").show() } else { $("#btnAddToKitCart").hide(); $("#btnAddToKitNotice").show() } } } } }); $body.delegate("#productconfirm", "click", function () { var iskit = $("#hdIsKit").val(); if (($("#hdOldWareCode").val() == null || $("#hdOldWareCode").val() == "") && _this.el.prm_code != '') { var PrmType = $("#hdPrmTypeCode").val(); if (iskit == "0") { var spec = $("#liSizek a.selon").attr("spec"); var a1 = spec.split(","); var newWareCode = a1[0]; var qty = $("#selectCountk").val(); _this.AddPromote(_this.el.prm_code, newWareCode, qty) } else { var subKitWareCount = ""; var subKitWareCodes = ""; var boo = true; var KitWareQty = $("#hdKitWareQty").val() * 1; $(".liSizek").each(function (i) { var length = $("#liSize" + i + " a.selon").size(); if (length == 0) { _this.alertDialog("请选择尺码"); boo = false; return false } var size = $("#liSize" + i + " a.selon"); var count = $("#selectCount" + i).val(); if (size.size() > 0 && count != "0") { var spec = size.attr("spec"); var a1 = spec.split(","); subKitWareCodes += a1[0] + "|"; subKitWareCount += count + "|" } }); var kitWareCode = $("#hdKitWareCode").val(); _this.AddPromoteKit(MLMarket.PrmCode, kitWareCode, subKitWareCodes, subKitWareCount) } _this.el.prm_code = ""; return } if (iskit == "0") { _this.addToCart() } else { _this.addToKitCart() } }); $body.delegate("#productcancel", "click", function () { _this.el.prm_code = ""; $("#J_dialog").dialog("close") }) }, editPageEvent: function () { var _this = this; focusBlur('#J_add_gid', '网址或商品号'); $('body').delegate('#J_add_goods', 'click', function () { var product_code = $("#J_add_gid").val(); if (product_code == '' || product_code == '网址或商品号') { _this.alertDialog('请输入网址或商品号'); return } if (product_code.length > 9) { product_code = product_code.substring(product_code.lastIndexOf('-') + 1, product_code.lastIndexOf('.')); if (product_code.length == 0) { _this.alertDialog('请输入正确的网址或商品号'); return } } if (product_code.length != 9) { _this.alertDialog('请输入正确的网址或商品号'); return } _this.el.prm_code = ''; MLMarket.ShoppingCartProduct(product_code) }) }, delComfirm: function () { var _this = this, goods_data = _this.el.goods_list_data, warecode = _this.el.del_data.warecode, html, del_data, delArglength = arguments.length; _this.el.load_dialog.dialog('open'); $.post('/cart/removeCartItem', _this.el.del_data, function (data) { if (data.Code == '1') { if (delArglength <= 0) { _this.el.delete_section.removeClass('fn-none'); for (var l = 0, length = goods_data.length; l < length; l++) { if (goods_data[l] && (goods_data[l]['WareCode'] == warecode)) { if (goods_data[l]['IsKit'] == 1) { var kit_data = goods_data[l], kit_detail = kit_data['KitDetail']; kit_data['SubKitWareCodes'] = ''; kit_data['SubKitWareCount'] = ''; for (var i = 0, length = kit_detail.length; i < length; i++) { kit_data['SubKitWareCodes'] += kit_detail[i]['WareCode'] + '|'; kit_data['SubKitWareCount'] += kit_detail[i]['Qty'] + '|' } } del_data = goods_data[l] } } html = easyTemplate(_this.tpl.delete_tpl, del_data).toString(); _this.el.delete_con.append(html) } _this.changePost() } else { _this.alertDialog(data.Message) } }, 'json') }, updateCartQty: function ($this, value) { var _this = this; if (_this.el.qty_data.qty <= 0 || _this.el.qty_data.qty >= 21) { _this.messageDialog('数量大于0并且小于21'); $this.val($this.attr('data-qty')); return } _this.el.load_dialog.dialog('open'); $.post('/cart/updatecartqty', _this.el.qty_data, function (data) { if (!data) { _this.el.load_dialog.dialog('close'); alert("数据异常，请稍后再试！"); return } if (data.Code == "1") { _this.changePost() } else { _this.el.load_dialog.dialog('close'); $this.val($this.attr('data-qty')); _this.messageDialog(data.Message) } }, 'json') }, chkAll: function (checked) { var _this = this; if (arguments.length == 0) { var chk = $('.chkalls'), length = chk.length, chk_num = 0; $('.chkalls').each(function () { var chk_chk = $(this).attr('checked'); if (chk_chk) { chk_num++ } }); if (!_this.el.is_can_submit) { $('.toSettlement').attr('id', '').addClass('display-btn') } else { $('.toSettlement').attr('id', 'J_toSettlement').removeClass('display-btn') } if (chk_num < length) { _this.chkAll(false) } else { _this.chkAll(true) } } else { _this.el.chk_all[0].checked = checked } }, chkEvent: function () { var _this = this; _this.el.chk_all.bind('click', function () { var checked = $(this)[0].checked; _this.el.input_data.warecode = "allselect"; _this.el.input_data.isselect = checked ? 1 : 0; _this.updateCartSelect(_this.el.input_data) }); _this.el.goods_content.delegate('.chkalls', 'click', function () { var $this = $(this), checked = $(this)[0].checked; _this.el.input_data.warecode = $(this).attr('data-wareCode'); _this.el.input_data.kitorder = $(this).attr('data-kitOrder'); _this.el.input_data.isselect = checked ? 1 : 0; _this.updateCartSelect() }) }, updateCartSelect: function (callBack) { var _this = this; _this.el.load_dialog.dialog('open'); $.post('/cart/updatecartselect', _this.el.input_data, function (data) { if (!data) { _this.el.load_dialog.dialog('close'); alert("数据异常，请稍后再试！"); return } if (data.Code == '1') { _this.changePost() } else { _this.messageDialog(data.Message) } }, 'json') }, addToCart: function () { var _this = this; var length = $("#liSizek a.selon").size(); if (length == 0) { _this.alertDialog("请选择尺码"); return } var counts = $("#selectCountk").val(); if (counts == "0") { _this.alertDialog("请选择购买数量"); $("#selectCountk").focus(); return } var spec = $("#liSizek a.selon").attr("spec"); var a1 = spec.split(","); var newWareCode = a1[0]; var oldWareCode = $("#hdOldWareCode").val(); var webSiteId = $("#hdWebSiteId").val(); var kitOrder = $("#hdKitOrder").val(); _this.el.load_dialog.dialog("open"); $.post('/Cart/UpdateCartItem', { Qty: counts, newWareCode: newWareCode, oldWareCode: oldWareCode, WebSiteId: webSiteId, KitOrder: kitOrder }, function (result) { $("#J_dialog").dialog("close"); if (result.Code == "1") { _this.changePost() } else { _this.el.load_dialog.dialog("close"); _this.messageDialog(result.Message) } }) }, addToKitCart: function () { var _this = this; var oldWareCode = $("#hdOldWareCode").val(); var newWareCode = oldWareCode; var webSiteId = $("#hdWebSiteId").val(); var kitOrder = $("#hdKitOrder").val(); var subKitWareCount = ""; var subKitWareCodes = ""; var boo = true; var KitWareQty = $("#hdKitWareQty").val() * 1; $(".liSizek").each(function (i) { var length = $("#liSize" + i + " a.selon").size(); if (length == 0) { _this.alertDialog("请选择尺码"); boo = false; return false } var size = $("#liSize" + i + " a.selon"); var count = $("#selectCount" + i).val(); if (size.size() > 0 && count != "0") { var spec = size.attr("spec"); var a1 = spec.split(","); subKitWareCodes += a1[0] + "|"; subKitWareCount += count + "|" } }); var stylecode = $("#hdStyleCode").val(); if (boo) { if (newWareCode == '') { $.ajax({ type: 'get', url: '/ShoppingHandler/ShoppingHandler', datatype: 'jsonp', data: { action: 'addtokitcart', SubKitWareCodes: subKitWareCodes, SubKitWareCount: subKitWareCount, WebSiteId: webSiteId, KitType: 1, kitStyleId: stylecode }, success: function (result) { result = eval(result); if (result.Status == "OK") { $("#J_dialog").dialog("close"); _this.changePost() } else { if (!result.Message) { _this.messageDialog(result.Status) } else { _this.messageDialog(result.Message) } } } }) } else { $.ajax({ type: 'post', url: '/Cart/UpdateCartKit', datatype: 'json', data: { SubKitWareCodes: subKitWareCodes, SubKitWareCount: subKitWareCount, newWareCode: newWareCode, oldWareCode: oldWareCode, WebSiteId: webSiteId, KitOrder: kitOrder, KitType: 1, kitStyleId: stylecode }, success: function (result) { if (result.Code == "1") { $("#J_dialog").dialog("close"); _this.changePost() } else { _this.messageDialog(result.Message) } } }) } } }, colorChange: function () { $(".selectcolor").live("click", function () { var attColor = $(this).attr("color"); var attTitle = $(this).attr("title"); var attForSize = $(this).attr("forSize"); var attStyleId = $(this).attr("styleId"); $("#txtSize" + attForSize).text(""); $("#liSize" + attForSize).html("<span style='color:red;'>数据加载中.....</span>"); var color = $("#SColor").val(); if (attColor != color) { $("#SColor").val(attColor); $("#txtselcolor" + attForSize).text(attTitle); $(this).addClass("selon").siblings().removeClass("selon"); var data = $("#hdColorSize").val(); data = eval('(' + data + ')'); for (var i = 0; i < data.length; i++) { if (data[i].StyleCode.toLowerCase() == attStyleId.toLowerCase()) { for (var j = 0; j < data[i].ColorArr.length; j++) { if (data[i].ColorArr[j].ColorCode == attColor) { var sizes = data[i].ColorArr[j].SpecArr; var styleId = $("#hdStyleId").val(); var strSizes = ""; for (var i = 0; i < sizes.length; i++) { strSizes += '<a  class="selectsize" id="selectsize' + attForSize + '"  title="' + styleId + '" spec="' + sizes[i].WareCode + '" forSize="' + attForSize + '" href="javascript:void(0)" >' + sizes[i].Spec + '</a>' } $("#liSize" + attForSize).html(strSizes); if (sizes.length > 1) { $("#spanCount" + attForSize).html("") } else { var size = $("#selectsize" + attForSize); $(size).bind("click", selectSizeHandle); $(size).trigger("click") } break } } break } } } }) }, soChange: function (options) { $(options.menu).soChange({ thumbObj: options.items, thumbNowClass: 'on', botNext: '#J_popular_next' }) }, deleteColumnEvent: function () { var _this = this; $('body').delegate('.J_collection', 'click', function () { var $this = $(this), stylecode = $this.attr('data-styleCode'); _this.el.load_dialog.dialog('open'); var url = 'http://common.moonbasa.com/common/AddtoFav7'; $.ajax({ type: 'get', url: url, dataType: 'jsonp', data: { styleCode: stylecode }, success: function (data) { _this.el.load_dialog.dialog('close'); if (data.value == "-1") { $("#SpanLogin").html("<iframe src=\"" + LoginDomain + "/iframe/login\" height=\"407px\" width=\"490px\" style=\"border:0;\"></iframe>"); $('#divlogin').dialog({ autoOpen: true, width: 550, height: 470, modal: true }); return } _this.messageDialog(data['text']); if (data['value'] != 1) { return } var count; $this.parents('.nr').remove(); count = _this.el.delete_con.find('.nr').length; if (count == 0) { _this.el.delete_section.addClass('fn-none') } } }) }); $('body').delegate('.J_repeat_buy', 'click', function () { var $this = $(this), stylecode = $this.attr('data-stylecode'), warecode = $this.attr('data-warecode'), isKit = $this.data('kitorder'), qty = $this.next('.J_del_num').val(), data = {}; var url = '/ShoppingHandler.aspx'; if (isKit == 0) { data = { Action: 'AddToCart', Qty: qty, WareCode: warecode} } else { data = { Action: 'addtokitcart', kitStyleId: stylecode, SubKitWareCodes: $this.data('subkitwarecodes'), SubKitWareCount: $this.data('subkitwarecount'), KitType: 1, WebSiteId: ''} } _this.el.load_dialog.dialog('open'); $.ajax({ type: 'get', url: url, dataType: 'jsonp', data: data, success: function (data) { var count; $this.parents('.nr').remove(); count = _this.el.delete_con.find('.nr').length; if (count == 0) { _this.el.delete_section.addClass('fn-none') } _this.changePost() } }) }) }, promoteEvent: function () { var _this = this; _this.el.promote_con.delegate('#J_more', 'click', function () { var $this = $(this), more_bg = $this.find('.more-bg'), state = more_bg.hasClass('more-show') ? 1 : 0; $('dl', '#J_promote_con').each(function (index, element) { var $element = $(element); if (state == 1) { if ($element.is(':hidden')) { $element.removeClass('fn-none') } } else { if (index > 4 && !$(element).hasClass('more')) { if (!$element.is(':hidden')) { $element.addClass('fn-none') } } } }); if (state) { more_bg.removeClass('more-show') } else { more_bg.addClass('more-show') } }); _this.el.promote_con.delegate('.J_add_prm', 'click', function () { _this.AddPromote($(this).attr('data-prmCode')) }); _this.el.promote_con.delegate('.J_show_prm', 'click', function () { var $this = $(this); _this.ShowPromoteItem($this.attr('data-prmCode'), $this.attr('data-prmSubId'), $this.attr('data-prmTypeCode')) }) }, removePromote: function () { var _this = this; _this.el.goods_content.delegate('.J_git_del', 'click', function () { var $this = $(this), is_kit = $this.attr('data-isKit'), ware_code = $this.attr('data-WareCode'), pro_code = $this.attr('data-proCode'), data = {}; if (is_kit == "dit") { data.prmcode = pro_code } else if (is_kit == '01') { data.prmcode = pro_code; data.warecode = ware_code; data.kitorder = 1 } else { data.prmcode = pro_code; data.warecode = ware_code } $.ajax({ type: 'get', url: '/ProductPromote/RemovePromote', data: data, dataType: 'jsonp', jsonp: "callback", success: function (result) { if (!result) { _this.alertDialog(_this.message.ajax_error); return } if (result.Code == "1") { _this.messageDialog('删除活动成功！'); _this.changePost() } else { _this.messageDialog(result.Message) } } }) }) }, AddPromote: function (prmcode, warecode, qty) { var _this = this; _this.el.load_dialog.dialog("open"); $.ajax({ type: 'get', url: '/ProductPromote/AddPromote', data: { prmcode: prmcode, warecode: warecode, qty: qty }, dataType: 'jsonp', jsonp: "callback", success: function (result) { $("#J_dialog").dialog("close"); $("#divPromoteItem").dialog("close"); if (!result) { return } if (result.Code == "1") { _this.el.load_dialog.dialog("close"); _this.messageDialog('添加活动成功！'); _this.changePost() } else { _this.messageDialog(result.Message); _this.el.load_dialog.dialog("close") } } }) }, AddPromoteKit: function (prmcode, kitWareCode, SubKitWareCodes, SubKitWareCount) { var _this = this; _this.el.load_dialog.dialog("open"); $.ajax({ type: 'get', url: '/ProductPromote/AddPromoteKit', data: { prmcode: prmcode, kitWareCode: kitWareCode, SubKitWareCodes: SubKitWareCodes, SubKitWareCount: SubKitWareCount }, dataType: 'jsonp', jsonp: "callback", success: function (result) { $("#J_dialog").dialog("close"); $("#divPromoteItem").dialog("close"); if (result.Code == "1") { _this.el.load_dialog.dialog("close"); _this.messageDialog('添加活动成功！'); _this.changePost() } else { _this.messageDialog(result.Message); _this.el.load_dialog.dialog("close") } } }) }, ShowPromoteItem: function (prmcode, prmsubid, prmtype) { var _this = this; _this.el.prm_code = prmcode; $.ajax({ type: 'get', url: '/ProductPromote/ShowPromoteItem', data: { prmcode: prmcode, prmsubid: prmsubid, prmtype: prmtype }, dataType: 'html', success: function (data) { $("#divPromoteItem").html(data).hide(); var title = $("#hdPrmName").val(); if ($("#hdIsAutoAdd").val() == "1") { _this.messageDialog('添加活动成功！'); _this.changePost() } else { $("#divPromoteItem").dialog({ title: title, width: 1000, modal: true }) } } }) }, changePost: function () { var _this = this; _this.goodsList() }, alertDialog: function (content) { var _this = this; _this.el.alert_content.html(content); _this.el.alert_dialog.dialog({ title: '提示信息', width: 410, modal: true }) }, numberMinus: function (number1, number2) { var r1, r2, m, n; try { r1 = number1.toString().split(".")[1].length } catch (e) { r1 = 0 } try { r2 = number2.toString().split(".")[1].length } catch (e) { r2 = 0 } m = Math.pow(10, Math.max(r1, r2)); n = (r1 >= r2) ? r1 : r2; return ((number1 * m - number2 * m) / m).toFixed(n) }, loadingDialog: function () { var _this = this; _this.el.loading_dialog.dialog({ title: '消息提示', width: 200, heigth: 150, modal: true }) }, messageDialog: function (msg) { var _this = this, t; _this.el.auto_dialog.html(msg); _this.el.auto_dialog.dialog('open'); t = setInterval(function () { if (_this.el.auto_dialog != null) { _this.el.auto_dialog.dialog('close'); clearInterval(t) } }, 5000) } }; orderShopCart.init(); var MLMarket = { ShoppingCartProduct: function (stylecode) { $.post("/cart/ShoppingCartProduct?stylecode=" + stylecode + "&prmcode=" + orderShopCart.el.prm_code, function (data) { $("#J_dialog").html(data); $('#J_dialog').dialog({ title: '选择颜色尺码', width: 600, modal: true }) }) } }; var isCombin = 1; var PartialLogin = { LoginBack: function () { $('#divlogin').dialog('close'); orderShopCart.el.is_login = 1; if (isCombin == "1") { $.ajax({ type: 'post', url: '/cart/getcartinfo', datatype: 'json', success: function (data) { isCombin = data.IsRealCombin; if (isCombin == false) { window.location.href = ShoppingCartDomain + "/order/orderpayment" } else { location.reload() } } }) } else { location.reload() } }, RegisterBack: function () { var _this = this; $('#divlogin').dialog('close'); orderShopCart.el.is_login = 1; if (isCombin == "1") { $.ajax({ type: 'post', url: '/cart/getcartinfo', datatype: 'json', success: function (data) { isCombin = data.IsRealCombin; if (isCombin == false) { window.location.href = ShoppingCartDomain + "/order/orderpayment" } else { location.reload() } } }) } else { location.reload() } }, ShowLoginDialog: function () { $("#SpanLogin").html("<iframe src=\"" + LoginDomain + "/iframe/login\" height=\"407px\" width=\"490px\" style=\"border:0;\"></iframe>"); $('#divlogin').dialog({ autoOpen: true, width: 550, height: 470, modal: true }) } }; window.PartialLogin = PartialLogin; window.MLMarket = MLMarket; window.orderShopCart = orderShopCart; function selectSizeHandle() { $(this).addClass("selon").siblings().removeClass("selon"); var attForSize = $(this).attr("forSize"); $("#txtSize" + attForSize).text($(this).text()); var spec = $(this).attr("spec"); var aitem = spec.split(","); if (aitem[0] == "") return; var count = aitem[1] * 1; var activeQty = count; if (count > 4 || count < 1) { count = 5 } if (!$("#selectCount" + attForSize).attr("disabled")) { var strRst = "<option value='0'>数量</option>"; for (var i = 1; i <= count; i++) { strRst += "<option value='" + i + "' >" + i + "</option>" } $("#selectCount" + attForSize).html(strRst); $("#selectCount" + attForSize).val("1") } if (activeQty > 0) { if (attForSize == "k") { $("#spanAddNotice").hide(); $("#spanAddCart").show() } else { if ($("#hdIsKit").val() == 1) { $("#spanAddKitNotice").hide(); $("#spanAddKitCart").show() } else { $("#btnAddToKitNotice").hide(); $("#btnAddToKitCart").show() } } if (activeQty < 20) { $("#spanCount" + attForSize).html("仅存<font color=red><b> 5 </b></font>件以下") } else if (activeQty < 10) { $("#spanCount" + attForSize).html("仅存<font color=red><b> 10 </b></font>件以下") } else { $("#spanCount" + attForSize).text("现在有货") } } else { if (aitem[2] * 1 < 17) { if (attForSize == "k") { $("#spanAddNotice").hide(); $("#spanAddCart").show() } else { if ($("#hdIsKit").val() == 1) { $("#spanAddKitNotice").hide(); $("#spanAddKitCart").show() } else { $("#btnAddToKitNotice").hide(); $("#btnAddToKitCart").show() } } if (aitem[2] == "0") { $("#spanCount" + attForSize).html("预计今天到货入库，入库后立即发货") } else { $("#spanCount" + attForSize).html("预计<font color=red style='font-size:13px;'><b> " + aitem[2] + " </b></font>天后到货入库，入库后立即发货") } } else { $("#spanCount" + attForSize).html($("#txtselcolor" + attForSize).text() + " " + $(this).text() + " 暂时缺货预计" + aitem[2] + "天后到货,商品到货时我们通知您。"); $(this).removeClass("selon"); $("#txtSize" + attForSize).text(""); $("#NoticeWareCode").val(aitem[0]); if (attForSize == "k") { $("#spanAddCart").hide(); $("#spanAddNotice").show() } else { if ($("#hdIsKit").val() == 1) { $("#spanAddKitCart").hide(); $("#spanAddKitNotice").show() } else { $("#btnAddToKitCart").hide(); $("#btnAddToKitNotice").show() } } } } } });